package go_clipper2_test

import (
	"fmt"
	"reflect"
	"testing"

	goclipper2 "github.com/bolom009/go-clipper2"
)

func TestInflatePaths64(t *testing.T) {
	subject := goclipper2.Paths64{
		{{0, 0}, {100, 0}, {100, 100}, {0, 100}},
	}

	tests := []struct {
		name        string
		delta       float64
		joinType    goclipper2.JoinType
		endType     goclipper2.EndType
		overSubject goclipper2.Paths64
		expect      goclipper2.Paths64
	}{
		{
			name:     "offset polygon with squire join type",
			delta:    40,
			joinType: goclipper2.Square,
			endType:  goclipper2.Polygon,
			expect: goclipper2.Paths64{
				{{140, -17}, {140, 117}, {117, 140}, {-17, 140}, {-40, 117}, {-40, -17}, {-17, -40}, {117, -40}},
			},
		},
	}

	for i, tt := range tests {
		t.Run(fmt.Sprintf("%d:%s", i, tt.name), func(t *testing.T) {
			results := goclipper2.InflatePaths64(subject, tt.delta, tt.joinType, tt.endType)
			if !reflect.DeepEqual(results, tt.expect) {
				t.Errorf("got %v, expect %v", results, tt.expect)
			}
		})
	}
}

func TestInflatePathsD(t *testing.T) {
	subject := goclipper2.PathsD{
		{{0, 0}, {100, 0}, {100, 100}, {0, 100}},
	}

	tests := []struct {
		name        string
		delta       float64
		joinType    goclipper2.JoinType
		endType     goclipper2.EndType
		overSubject goclipper2.PathsD
		expect      goclipper2.PathsD
	}{
		{
			name:     "offset polygon with squire join type",
			delta:    40,
			joinType: goclipper2.Square,
			endType:  goclipper2.Polygon,
			expect: goclipper2.PathsD{
				{{140.00, -16.57}, {140.00, 116.57}, {116.57, 140.00}, {-16.57, 140.00}, {-40.00, 116.57}, {-40.00, -16.57}, {-16.57, -40.00}, {116.57, -40.00}},
			},
		},
		{
			name:     "offset large uncommon polygon",
			delta:    -3,
			joinType: goclipper2.Miter,
			endType:  goclipper2.Polygon,
			overSubject: goclipper2.PathsD{
				{{X: 398.09, Y: -288.96}, {X: 375.44, Y: -263.02}, {X: 401.06, Y: -242.65}, {X: 387.56, Y: -208.36}, {X: 429.13, Y: -146.17}, {X: 454.03, Y: -146.17}, {X: 454.03, Y: -111.73}, {X: 486.73, Y: -113.24}, {X: 488.21, Y: -109.07}, {X: 529.19, Y: -125.86}, {X: 529.19, Y: -162.1}, {X: 557.37, Y: -162.1}, {X: 557.37, Y: -126.36}, {X: 584.38, Y: -202.03}, {X: 556.79, Y: -202.03}, {X: 556.79, Y: -236.47}, {X: 641.93, Y: -236.47}, {X: 641.93, Y: -202.03}, {X: 674.63, Y: -203.54}, {X: 701.64, Y: -127.88}, {X: 668.94, Y: -126.36}, {X: 668.94, Y: -88.4}, {X: 529.19, Y: -88.4}, {X: 529.19, Y: -94.81}, {X: 497.89, Y: -81.97}, {X: 513.74, Y: -37.58}, {X: 481.04, Y: -36.06}, {X: 481.04, Y: 1.9}, {X: 341.29, Y: 1.9}, {X: 341.29, Y: -5.98}, {X: 291.13, Y: 1.21}, {X: 297.64, Y: 19.42}, {X: 264.94, Y: 20.94}, {X: 264.94, Y: 58.9}, {X: 125.19, Y: 58.9}, {X: 125.19, Y: 44.37}, {X: 85.44, Y: 44.37}, {X: 90.19, Y: 57.68}, {X: 57.5, Y: 59.19}, {X: 57.5, Y: 97.16}, {X: -82.25, Y: 97.16}, {X: -82.25, Y: 23.45}, {X: -54.07, Y: 23.45}, {X: -54.07, Y: 59.19}, {X: -27.06, Y: -16.48}, {X: -54.65, Y: -16.48}, {X: -54.65, Y: -50.91}, {X: -37.98, Y: -50.91}, {X: -71.39, Y: -102.3}, {X: -161.51, Y: -102.3}, {X: -161.51, Y: -176.0}, {X: -133.33, Y: -176.0}, {X: -133.33, Y: -140.26}, {X: -106.32, Y: -215.93}, {X: -133.91, Y: -215.93}, {X: -133.91, Y: -250.37}, {X: -48.77, Y: -250.37}, {X: -48.77, Y: -215.93}, {X: -16.07, Y: -217.44}, {X: -1.6, Y: -176.93}, {X: 45.59, Y: -165.55}, {X: 45.59, Y: -172.6}, {X: 73.77, Y: -172.6}, {X: 73.77, Y: -136.86}, {X: 100.78, Y: -212.53}, {X: 73.19, Y: -212.53}, {X: 73.19, Y: -246.97}, {X: 107.06, Y: -246.97}, {X: 107.06, Y: -280.42}, {X: 95.65, Y: -280.82}, {X: 79.22, Y: -311.72}, {X: 97.77, Y: -341.4}, {X: 132.75, Y: -340.18}, {X: 144.21, Y: -318.61}, {X: 242.42, Y: -282.09}, {X: 264.25, Y: -307.09}, {X: 285.48, Y: -288.56}, {X: 261.97, Y: -261.64}, {X: 332.08, Y: -300.87}, {X: 311.3, Y: -319.02}, {X: 333.95, Y: -344.96}},
			},
			expect: goclipper2.PathsD{
				{{393.85, -288.67}, {371.11, -262.63}, {397.45, -241.67}, {384.19, -208}, {427.53, -143.17}, {451.03, -143.17}, {451.03, -108.59}, {484.64, -110.13}, {486.44, -105.1}, {532.19, -123.85}, {532.19, -159.1}, {554.37, -159.1}, {554.37, -123.83}, {559.35, -122.97}, {588.64, -205.03}, {559.79, -205.03}, {559.79, -233.47}, {638.93, -233.47}, {638.93, -198.89}, {672.54, -200.43}, {697.44, -130.69}, {665.94, -129.22}, {665.94, -91.4}, {532.19, -91.4}, {532.19, -99.28}, {494.1, -83.66}, {509.54, -40.39}, {478.04, -38.92}, {478.04, -1.1}, {344.29, -1.1}, {344.29, -9.44}, {287.07, -1.24}, {293.45, 16.61}, {261.94, 18.08}, {261.94, 55.9}, {128.19, 55.9}, {128.19, 41.37}, {81.18, 41.37}, {85.99, 54.87}, {54.5, 56.33}, {54.5, 94.16}, {-79.25, 94.16}, {-79.25, 26.45}, {-57.07, 26.45}, {-57.07, 61.72}, {-52.09, 62.58}, {-22.8, -19.48}, {-51.65, -19.48}, {-51.65, -47.91}, {-36.19, -47.91}, {-34.49, -51.05}, {-69.76, -105.3}, {-158.51, -105.3}, {-158.51, -173}, {-136.33, -173}, {-136.33, -137.73}, {-131.35, -136.87}, {-102.06, -218.93}, {-130.91, -218.93}, {-130.91, -247.37}, {-51.77, -247.37}, {-51.77, -212.79}, {-18.16, -214.33}, {-3.88, -174.39}, {48.59, -161.74}, {48.59, -169.6}, {70.77, -169.6}, {70.77, -134.33}, {75.75, -133.47}, {105.04, -215.53}, {76.19, -215.53}, {76.19, -243.97}, {110.06, -243.97}, {110.06, -283.32}, {97.49, -283.75}, {82.68, -311.6}, {99.39, -338.33}, {130.92, -337.24}, {142.1, -316.2}, {243.32, -278.56}, {264.53, -302.86}, {281.24, -288.27}, {258.05, -261.71}, {261.23, -257.79}, {337.26, -300.33}, {315.53, -319.3}, {334.23, -340.72}},
			},
		},
	}

	for i, tt := range tests {
		t.Run(fmt.Sprintf("%d:%s", i, tt.name), func(t *testing.T) {
			if tt.overSubject != nil {
				subject = tt.overSubject
			}

			results := goclipper2.InflatePathsD(subject, tt.delta, tt.joinType, tt.endType)
			if !reflect.DeepEqual(results, tt.expect) {
				t.Errorf("got %v, \n\t\t    expect %v", results, tt.expect)
			}
		})
	}
}
